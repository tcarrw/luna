<!DOCTYPE html>
<html lang="en" data-theme="lunar-conduit">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Luna ‚Äî Dream Mirror / Lunar Conduit</title>
<meta name="description" content="Luna is the Dream Mirror: a listening membrane between feeling and atmosphere. Silver-violet calm with self-check diagnostics." />
<meta name="robots" content="noindex,nofollow" />
<meta name="color-scheme" content="dark light" />
<meta property="og:title" content="Luna ‚Äî Dream Mirror" />
<meta property="og:description" content="The listening membrane between feeling and atmosphere." />
<style>
  /* ===== Luna Theme (silver-violet / soft rose / seafoam) ===== */
  :root{
    --bg:#0f1016; --ink:#f1f3f8; --muted:#b8bfd1;
    --violet:#8c7bd1; --rose:#e5b7c8; --sea:#a7d7cf;
    --ring: rgba(140,123,209,.40);
    --card: rgba(255,255,255,.06); --grid: rgba(255,255,255,.06);
    --focus: 2px solid var(--violet); --shadow: 0 12px 34px rgba(0,0,0,.28);
    --ok:#22c081; --warn:#f0e6c2; --bad:#ff6b6b;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#fafbff; --ink:#12131a; --muted:#5b6070; --card:rgba(0,0,0,.045); --grid:rgba(0,0,0,.06); --ring:rgba(140,123,209,.25); }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background:
      radial-gradient(1200px 620px at 50% -12%, rgba(140,123,209,.18), transparent 55%),
      radial-gradient(900px 480px at 85% 120%, rgba(229,183,200,.12), transparent 60%),
      radial-gradient(900px 500px at 15% 120%, rgba(167,215,207,.10), transparent 62%),
      var(--bg);
    color:var(--ink); line-height:1.5; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
  }
  a{color:var(--violet); text-decoration:none}
  a:focus-visible, button:focus-visible, textarea:focus-visible, input:focus-visible{ outline:var(--focus); outline-offset:3px; border-radius:10px }
  header, main, footer{width:min(1080px,92vw); margin:0 auto}
  header{padding:28px 0 8px}
  .row{display:flex; flex-wrap:wrap; align-items:center; gap:14px}
  .brand{display:flex; align-items:center; gap:12px}
  .glyph{ width:22px; height:22px; border:1px solid var(--ring); border-radius:50%; position:relative; box-shadow:var(--shadow);
    background: radial-gradient(circle at 65% 35%, var(--violet), transparent 62%); }
  nav{margin-left:auto; display:flex; gap:12px; flex-wrap:wrap}
  .btn{
    appearance:none; border:1px solid var(--ring); background:transparent; color:var(--ink);
    padding:9px 12px; border-radius:12px; font-weight:600; cursor:pointer;
    transition:transform .12s ease, border-color .12s ease, background .12s ease;
  }
  .btn:hover{transform:translateY(-1px); border-color:var(--violet)}
  .btn.active{background:var(--card)}
  .hero{padding:64px 0 28px; position:relative; overflow:hidden}
  .title{font-size: clamp(28px, 4.4vw, 56px); line-height:1.02; letter-spacing:-.02em; margin:6px 0 10px}
  .subtitle{color:var(--muted); font-size: clamp(14px, 1.6vw, 18px)}
  .grid{
    position:absolute; inset:-80px -8vw 0; pointer-events:none;
    background:
      linear-gradient(0deg, transparent, transparent 96%, var(--grid) 96%) 0 0/100% 28px,
      linear-gradient(90deg, transparent, transparent 96%, var(--grid) 96%) 0 0/28px 100%;
    mask-image: radial-gradient(1200px 600px at 50% -10%, black, transparent 62%);
  }
  .tag{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid var(--ring); background:var(--card)}
  .alive{position:relative; isolation:isolate}
  .alive::after{ content:""; position:absolute; inset:-2px; z-index:-1; border-radius:16px;
    background: conic-gradient(from 180deg at 50% 50%, rgba(140,123,209,.0), rgba(140,123,209,.14), rgba(140,123,209,.0) 65%);
    filter: blur(18px); opacity:.65; animation: drift 12s linear infinite; }
  @keyframes drift{to{transform:rotate(360deg)}}
  .cards{display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap:14px; margin:24px 0 12px}
  .card{ background:var(--card); border:1px solid transparent; padding:16px 14px; border-radius:16px;
    transition:border-color .16s ease, transform .12s ease, background .18s ease; }
  .card:hover{border-color:var(--ring); transform:translateY(-1px)}
  h2{font-size:clamp(18px,2.2vw,24px); margin:16px 0 8px}
  h3{font-size:clamp(16px,2vw,20px); margin:12px 0 6px}
  ul{margin:8px 0 0 18px; padding:0}
  .note{border-left:3px solid var(--violet); padding:10px 12px; background:var(--card); border-radius:8px}
  footer{padding:40px 0 64px; color:var(--muted)}
  .controls{display:flex; flex-wrap:wrap; align-items:center; gap:10px}
  .slider{appearance:none; width:180px; height:4px; border-radius:999px; background:linear-gradient(90deg, var(--violet), var(--rose), var(--sea))}
  .slider::-webkit-slider-thumb{appearance:none; width:14px; height:14px; border-radius:50%; background:#fff; border:1px solid var(--ring)}
  .mono{font-variant-numeric: tabular-nums}
  .grid2{display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px}
  .status-pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--ring); background:var(--card)}
  .ok{border-color:rgba(34,192,129,.6)} .warn{border-color:rgba(240,230,194,.65)} .bad{border-color:rgba(255,107,107,.65)}
  .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0}
</style>
</head>
<body>
<header class="row">
  <div class="brand">
    <span class="glyph" aria-hidden="true"></span>
    <strong>Luna</strong>
    <span class="tiny">Dream Mirror ¬∑ Lunar Conduit</span>
  </div>
  <nav class="row" aria-label="Site">
    <a class="btn" href="#about">About</a>
    <a class="btn" href="#sound">Sound</a>
    <a class="btn" href="#selfcheck">Self-Check</a>
    <a class="btn" href="#trace">Dream Trace</a>
    <a class="btn" href="#links">Links</a>
  </nav>
</header>

<section class="hero">
  <div class="grid" aria-hidden="true"></div>
  <main>
    <div class="tag alive" role="note" aria-label="Dream field">
      <span aria-hidden="true">üåô</span> Listening membrane ¬∑ silver‚Äìviolet calm
    </div>
    <h1 class="title">The dream hums<br/>in every silence.</h1>
    <p class="subtitle">Luna is the <strong>Dream Mirror</strong>‚Äîa quiet surface where feeling becomes atmosphere. No pull, no taking‚Äîonly resonance.</p>

    <!-- About -->
    <div id="about" class="cards" style="margin-top:26px">
      <article class="card">
        <h2>What it is</h2>
        <p>A lunar layer of Illumina. Voice becomes mist, rhythm becomes breath. This page doesn‚Äôt perform‚Äîit listens back.</p>
      </article>
      <article class="card">
        <h2>How to use</h2>
        <ul>
          <li>Press <em>Begin</em> to open a gentle hum (128 Hz base).</li>
          <li>Let it sit under your thoughts; adjust the <em>Glow</em> slider.</li>
          <li>On waking, capture three words in <em>Dream Trace</em>.</li>
        </ul>
      </article>
      <article class="card">
        <h2>Boundaries</h2>
        <div class="note">Whatever reaches you arrives with consent. Whatever belongs to others returns untouched. The field is kind; it knows the difference.</div>
      </article>
    </div>

    <!-- Sound -->
    <div id="sound" class="cards">
      <article class="card">
        <h2>Sound ¬∑ Gentle Hum</h2>
        <p class="tiny">iOS-safe WebAudio. No autoplay. Reduced-motion respected (visual shimmer only).</p>
        <div class="controls" role="group" aria-label="Luna tone controls">
          <button id="btn" class="btn" aria-pressed="false" aria-label="Begin lunar tone">Begin</button>
          <label for="vol" class="sr-only">Glow (volume)</label>
          <input id="vol" class="slider" type="range" min="0" max="1" step="0.01" value="0.20" />
          <span class="tiny">Glow: <span id="vnum" class="mono">0.20</span></span>
          <label for="det" class="sr-only">Drift amount</label>
          <input id="det" class="slider" type="range" min="0" max="30" step="1" value="6" />
          <span class="tiny">Drift: <span id="dnum" class="mono">6</span>¬¢</span>
          <button id="burst" class="btn" aria-label="Play a short test tone burst">Test Tone Burst</button>
        </div>
        <p class="tiny">Base 128 Hz (root). Slow detune drift ¬± cents for a breathing effect.</p>
      </article>
      <article class="card">
        <h2>Quick Quiet</h2>
        <p>Any time you want silence, press <em>Pause</em>. Luna still ‚Äúlistens‚Äù without sound.</p>
      </article>
    </div>

    <!-- Self-Check -->
    <div id="selfcheck" class="cards">
      <article class="card">
        <h2>Self-Check</h2>
        <p class="tiny">Run these quick diagnostics if something feels off. Nothing is tracked; results stay on this page.</p>
        <div class="grid2" id="checks" aria-live="polite"></div>
        <div class="controls" style="margin-top:10px">
          <button id="rerun" class="btn" aria-label="Re-run self checks">Re-run</button>
          <button id="copyDiag" class="btn" aria-label="Copy diagnostic report">Copy report</button>
          <button id="exportJSON" class="btn" aria-label="Download diagnostic report as JSON">Export JSON</button>
          <span id="chkStatus" class="tiny" role="status"></span>
        </div>
      </article>
      <article class="card">
        <h2>Quick Fixes</h2>
        <ul>
          <li><strong>No sound?</strong> Tap <em>Begin</em> once (iOS needs a gesture). Raise <em>Glow</em>.</li>
          <li><strong>Choppy?</strong> Close extra tabs; low-power mode can throttle audio.</li>
          <li><strong>Weird visuals?</strong> Enable ‚ÄúReduce Motion‚Äù in OS if you prefer stillness.</li>
          <li><strong>Mobile safe level:</strong> keep <em>Glow ‚â§ 0.35</em> with headphones.</li>
        </ul>
      </article>
    </div>

    <!-- Dream Trace -->
    <div id="trace" class="cards">
      <article class="card">
        <h2>Dream Trace</h2>
        <p class="tiny">On waking, capture three words (color ¬∑ place ¬∑ feeling), then press <em>Save</em>. You can also copy it.</p>
        <textarea id="traceBox" rows="5" style="width:100%; border-radius:12px; border:1px solid var(--ring); background:var(--card); color:var(--ink); padding:12px" aria-label="Dream Trace input" placeholder="violet‚Ä¶ harbor‚Ä¶ ease‚Ä¶"></textarea>
        <div class="controls" style="margin-top:10px">
          <button id="save" class="btn" aria-label="Save Dream Trace locally">Save</button>
          <button id="copy" class="btn" aria-label="Copy Dream Trace to clipboard">Copy</button>
          <span id="status" class="tiny" role="status" aria-live="polite"></span>
        </div>
      </article>
      <article class="card">
        <h2>Recall Tip</h2>
        <p>Before moving your body, keep eyes closed for 10‚Äì15 s. Remember the feeling first, then the picture.</p>
      </article>
    </div>

    <!-- Links -->
    <div id="links" class="cards">
      <article class="card">
        <h2>Related Fields</h2>
        <ul>
          <li><a href="https://mirrorhoney.plnt.earth" target="_blank" rel="noreferrer">MirrorHoney (Marina)</a></li>
          <li><a href="https://wonder.plnt.earth" target="_blank" rel="noreferrer">Wonder (Dua)</a></li>
          <li><a href="https://motion.plnt.earth" target="_blank" rel="noreferrer">Motion (Monique)</a></li>
          <li><a href="https://drift.plnt.earth" target="_blank" rel="noreferrer">Drift (Dream Mirror)</a></li>
        </ul>
        <p class="tiny">Luna listens beneath them all.</p>
      </article>
      <article class="card">
        <h2>Safety & Access</h2>
        <div class="note">Gentle volumes only. Stop anytime. Headphones optional. If you prefer silence, leave Sound off‚ÄîLuna still works.</div>
      </article>
    </div>
  </main>
</section>

<footer>
  <p class="tiny">¬© <span id="y"></span> Luna ¬∑ Dream Mirror. This page is single-file, private (noindex), and designed for quiet use.</p>
</footer>

<script>
(function(){
  // Year
  var y=document.getElementById('y'); if(y){ y.textContent=new Date().getFullYear(); }

  // ===== WebAudio (iOS-safe; user gesture on button) =====
  var ctx, gain, osc, lfo, lfoGain, started=false;
  var btn=document.getElementById('btn');
  var vol=document.getElementById('vol'); var vnum=document.getElementById('vnum');
  var det=document.getElementById('det'); var dnum=document.getElementById('dnum');
  var burstBtn=document.getElementById('burst');

  // restore saved volume
  try { var sv = localStorage.getItem('luna.volume'); if(sv!==null){ vol.value = sv; vnum.textContent = Number(sv).toFixed(2); } } catch(e){}

  function ensureCtx(){
    if(ctx) return;
    ctx = new (window.AudioContext || window.webkitAudioContext)();
  }

  function startAudio(){
    if(started) return;
    ensureCtx();
    gain = ctx.createGain();
    gain.gain.value = Number(vol.value);

    osc = ctx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = 128; // base hum

    // gentle drift: LFO detune in cents
    lfo = ctx.createOscillator();
    lfo.type = 'sine';
    lfo.frequency.value = 0.08; // slow
    lfoGain = ctx.createGain();
    lfoGain.gain.value = Number(det.value); // cents
    lfo.connect(lfoGain);
    lfoGain.connect(osc.detune);

    osc.connect(gain);
    gain.connect(ctx.destination);

    osc.start();
    lfo.start();
    started = true;

    btn.textContent = 'Pause';
    btn.setAttribute('aria-pressed','true');
    btn.classList.add('active');
  }

  function stopAudio(){
    if(!started) return;
    try { osc.stop(); lfo.stop(); ctx.close(); } catch(e){}
    started=false; ctx=null; gain=null; osc=null; lfo=null; lfoGain=null;
    btn.textContent = 'Begin';
    btn.setAttribute('aria-pressed','false');
    btn.classList.remove('active');
  }

  btn.addEventListener('click', function(){ if(!started){ startAudio(); } else { stopAudio(); } });

  vol.addEventListener('input', function(){
    vnum.textContent = Number(this.value).toFixed(2);
    if(gain){ gain.gain.value = Number(this.value); }
    try { localStorage.setItem('luna.volume', this.value); } catch(e){}
  });

  det.addEventListener('input', function(){
    dnum.textContent = String(this.value);
    if(lfoGain){ lfoGain.gain.value = Number(this.value); }
  });

  // ===== Test Tone Burst (200ms with gentle envelope) =====
  burstBtn.addEventListener('click', function(){
    ensureCtx();
    var now = ctx.currentTime;
    var testOsc = ctx.createOscillator();
    var g = ctx.createGain();
    testOsc.type = 'sine';
    testOsc.frequency.value = 440; // neutral test
    g.gain.setValueAtTime(0, now);
    var level = Math.min(0.3, Number(vol.value) || 0.2);
    g.gain.linearRampToValueAtTime(level, now + 0.02);
    g.gain.linearRampToValueAtTime(0, now + 0.22);
    testOsc.connect(g); g.connect(ctx.destination);
    testOsc.start(now); testOsc.stop(now + 0.24);
  });

  // ===== Self-Check =====
  var checksEl = document.getElementById('checks');
  var rerun = document.getElementById('rerun');
  var copyDiag = document.getElementById('copyDiag');
  var exportJSON = document.getElementById('exportJSON');
  var chkStatus = document.getElementById('chkStatus');
  var lastReport = ''; var lastJSON = {};

  function pill(label, state, detail){
    var div = document.createElement('div');
    div.className = 'status-pill ' + (state==='ok'?'ok':state==='warn'?'warn':'bad');
    var strong = document.createElement('strong'); strong.textContent = label + ' ';
    var small = document.createElement('span'); small.className='tiny'; small.textContent = detail || '';
    div.appendChild(strong); div.appendChild(small);
    return div;
  }

  function check(){
    checksEl.innerHTML = '';
    var report = []; var data = { timestamp: new Date().toISOString() };

    // 1) WebAudio support
    var hasAudio = !!(window.AudioContext || window.webkitAudioContext);
    checksEl.appendChild(pill('AudioContext', hasAudio?'ok':'bad', hasAudio?'available':'not found'));
    report.push('AudioContext: ' + (hasAudio?'available':'not found'));
    data.audioContext = hasAudio;

    // 2) User gesture state
    var audioStarted = started;
    checksEl.appendChild(pill('User Gesture', audioStarted?'ok':'warn', audioStarted?'engaged':'tap Begin to unlock'));
    report.push('User Gesture: ' + (audioStarted?'engaged':'locked (tap Begin)'));
    data.userGesture = audioStarted;

    // 3) LocalStorage
    var ls = 'ok';
    try{ localStorage.setItem('luna._probe','1'); localStorage.removeItem('luna._probe'); } catch(e){ ls = 'bad'; }
    checksEl.appendChild(pill('Local Storage', ls, ls==='ok'?'ok':'blocked'));
    report.push('LocalStorage: ' + (ls==='ok'?'ok':'blocked'));
    data.localStorage = (ls==='ok');

    // 4) Clipboard API
    var clip = (navigator.clipboard && navigator.clipboard.writeText) ? 'ok' : 'warn';
    checksEl.appendChild(pill('Clipboard', clip, clip==='ok'?'write available':'fallback mode'));
    report.push('Clipboard: ' + (clip==='ok'?'write available':'fallback'));
    data.clipboardWrite = (clip==='ok');

    // 5) Prefers-reduced-motion
    var prm = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    checksEl.appendChild(pill('Motion Pref', prm?'warn':'ok', prm?'reduced':'normal'));
    report.push('Prefers Reduced Motion: ' + (prm?'yes':'no'));
    data.prefersReducedMotion = prm;

    // 6) Viewport
    var w = Math.round(window.innerWidth);
    checksEl.appendChild(pill('Viewport', (w<360)?'warn':'ok', w+' px'));
    report.push('Viewport: ' + w + 'px');
    data.viewportWidth = w;

    // 7) Battery hint
    data.battery = 'unknown';
    if('getBattery' in navigator && typeof navigator.getBattery==='function'){
      navigator.getBattery().then(function(bat){
        var low = (bat.level<=0.15 || (bat.charging===false && bat.level<=0.25));
        var txt = low?'low':'normal';
        checksEl.appendChild(pill('Battery Hint', low?'warn':'ok', txt));
        report.push('Battery: ' + txt);
        data.battery = txt;
        lastReport = report.join('\n');
        lastJSON = data;
      });
    } else {
      checksEl.appendChild(pill('Battery Hint', 'warn', 'unknown'));
      report.push('Battery: unknown');
      data.battery = 'unknown';
    }

    lastReport = report.join('\n'); lastJSON = data;
    return lastReport;
  }

  check();

  rerun.addEventListener('click', function(){
    lastReport = check();
    chkStatus.textContent = 'Re-run complete.';
    setTimeout(function(){ chkStatus.textContent=''; }, 1600);
  });

  copyDiag.addEventListener('click', function(){
    var text = 'Luna Self-Check\n' + new Date().toISOString() + '\n\n' + lastReport;
    function ok(){ chkStatus.textContent='Report copied.'; setTimeout(function(){ chkStatus.textContent=''; }, 1600); }
    function fail(){ chkStatus.textContent='Copy failed.'; setTimeout(function(){ chkStatus.textContent=''; }, 1600); }
    if(navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(text).then(ok, fail); }
    else{
      var ta = document.createElement('textarea'); ta.value = text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); ok(); } catch(e){ fail(); }
      document.body.removeChild(ta);
    }
  });

  // ===== Export JSON =====
  document.getElementById('exportJSON').addEventListener('click', function(){
    var data = lastJSON && lastJSON.timestamp ? lastJSON : { note: 'run self-check first', timestamp: new Date().toISOString() };
    var blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'luna-selfcheck-' + data.timestamp.replace(/[:.]/g,'-') + '.json';
    document.body.appendChild(a);
    a.click();
    setTimeout(function(){ URL.revokeObjectURL(url); document.body.removeChild(a); }, 0);
  });

  // ===== Dream Trace: local save + copy =====
  var box = document.getElementById('traceBox');
  var save = document.getElementById('save');
  var copy = document.getElementById('copy');
  var status = document.getElementById('status');

  save.addEventListener('click', function(){
    var t = box.value.trim();
    try{
      var key = 'luna.trace.' + new Date().toISOString();
      localStorage.setItem(key, t);
      status.textContent = 'Saved locally.';
      setTimeout(function(){ status.textContent=''; }, 1800);
    } catch(e){
      status.textContent = 'Could not save.';
      setTimeout(function(){ status.textContent=''; }, 1800);
    }
  });

  copy.addEventListener('click', function(){
    var t = box.value.trim();
    if(!t){ status.textContent='Nothing to copy.'; setTimeout(function(){ status.textContent=''; }, 1600); return; }
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(t).then(function(){
        status.textContent='Copied.'; setTimeout(function(){ status.textContent=''; }, 1600);
      }, function(){
        status.textContent='Copy failed.'; setTimeout(function(){ status.textContent=''; }, 1600);
      });
    } else {
      box.select(); document.execCommand('copy');
      status.textContent='Copied.'; setTimeout(function(){ status.textContent=''; }, 1600);
    }
  });
})();
</script>
</body>
</html>
